use vault
go
--All Invoice Line Items (Monthly) Query
--All Unbundled Items (Monthly) Query
--Consolidated and Unbundled Invoice Line Items reports



SELECT QueryID, LastUpdated, QueryName
FROM tblQuery
Where QueryID IN (146, 628, 630, 625, 3072, 36, 89, 135, 147)



SELECT --QueryID, LastUpdated, QueryName
	'if(select LastUpdated from tblQuery where queryid = '+cast(QueryID as varchar) +') = '''+ format(LastUpdated, 'yyyy-MM-dd HH:mm:ss') +'''
	update tblQuery
	set TSQLText = ''''
	where QueryID = '+cast(QueryID as varchar) +'
else
	begin 
		select ''Update Failed queryid = ' +cast(QueryID as varchar) + ', '+ QueryName+'''
		select QueryID, QueryName,  TSQLText from tblQuery where QueryID = '+cast(QueryID as varchar) + '
	end'
FROM tblQuery
Where QueryID IN (146, 628, 630, 625, 3072, 36, 89, 135, 147)



if(select LastUpdated from tblQuery where queryid = 146) <= '2021-06-09 22:58:00'
	update tblQuery
	set TSQLText = ''
	where QueryID = 146
else
	begin 
		select 'Update Failed queryid = 146'
		select QueryID, QueryName,  TSQLText from tblQuery where QueryID = 146
	end


--Billing - Complete Finance Query - QueryID=146
--QueryID	QueryName	TSQLText
--146	2021-06-09 22:58:00	Billing - Complete Finance Query
--Select Distinct ServiceRequest.ServiceRequestID,    ServiceRequest.OrderIDF,    OrderSalesType.OrderSalesTypeName OrderSalesType,    ServiceRequest.SalesOrderIDF As [Sales Order],    Person.FullName As [Executed By],    SalesOrder.DateTimeExecuted,    Replace(Replace(Replace([Company (Client)].LegalName, Char(13) + Char(10),    ' '), Char(10), ' '), ',', ' ') As [Client Name],    Account.AccountID,    Replace(Replace(Replace(Account.AccountName, Char(13) + Char(10), ' '),    Char(10), ' '), ',', ' ') AccountName,    Replace(Replace(Replace(Site.CxSiteNumber, Char(13) + Char(10), ' '),    Char(10), ' '), ',', ' ') CxSiteNumber,    Replace(Replace(Replace(Site.SiteName, Char(13) + Char(10), ' '), Char(10),    ' '), ',', ' ') SiteName,    Replace(Replace(Replace(Site.SiteAddress1, Char(13) + Char(10), ' '),    Char(10), ' '), ',', ' ') SiteAddress1,    Site.SiteAddress2,    Replace(Replace(Replace(Site.SpaceNumber, Char(13) + Char(10), ' '), Char(10),    ' '), ',', ' ') SpaceNumber,    Site.SiteCity,    Site.SiteState,    Site.SiteZip,    Site.SiteID,    Replace(Replace(Replace(ServiceRequest.CxGLCode1, Char(13) + Char(10), ' '),    Char(10), ' '), ',', ' ') CxGLCode1,    Part.ProductClassName,    Part.SubClassName,    Part.IRGNumber As PartNumber,    Replace(Replace(Replace(Part.IRGDescription, Char(13) + Char(10), ' '),    Char(10), ' '), ',', ' ') IRGDescription,    ServiceRequest.IsSRLOA As [LOA Switch?],    ServiceRequest.EnablerRoleName As [Enabler Role],    ServiceRequest.CurrentServiceRequestStatus,    ServiceRequest.MainServiceRequestStatusName,    Workcenter.WorkcenterName,    ServiceRequest.ServiceStartDate,    ServiceRequest.ServiceEndDate,    ServiceRequest.BillingStartDate,    ServiceRequest.BillingEndDate,    ServiceRequest.CompletedDateTime,    ServiceRequest.RenewalDate,    tblTerm.StartDate As LastRenewalDate,    DateAdd(month, usysTermLength.LengthInMonths, tblTerm.StartDate) -    1 As [Term End Date],    ServiceRequest.TermDaysRemaining,    Account.TermLengthName,    Replace(Replace(Replace([Company (Vendor)].LegalName, Char(13) + Char(10),    ' '), Char(10), ' '), ',', ' ') [Vendor Name],    Part.BaseCost As [Base Cost],    Procurement1.UnitCost As [Actual Cost],    Procurement1.AnticipatedCost As [Anticipated Cost],    A.ExtPrice As [Client Price],    Replace(Replace(Replace(ServiceRequest.BundleName, Char(13) + Char(10), ' '),    Char(10), ' '), ',', ' ') BundleName,    Replace(Replace(Replace(ServiceRequest.VendorOrderNumber, Char(13) + Char(10),    ' '), Char(10), ' '), ',', ' ') VendorOrderNumber,    Replace(Replace(Replace(ServiceRequest.VendorCircuitID, Char(13) + Char(10),    ' '), Char(10), ' '), ',', ' ') VendorCircuitID,    Replace(Replace(Replace(Finance.VendorBTN, Char(13) + Char(10), ' '),    Char(10), ' '), ',', ' ') VendorBTN,    Replace(Replace(Replace(Finance.VendorBillingAccountNumber, Char(13) +    Char(10), ' '), Char(10), ' '), ',', ' ') VendorBillingAccountNumber,    Replace(Replace(Replace(Finance.VendorRegionalBillingNumber, Char(13) +    Char(10), ' '), Char(10), ' '), ',', ' ') VendorRegionalBillingNumber,    Procurement1.ActivationDate,    Procurement1.DueDate,    Procurement1.RequestedDueDate,    ServiceRequest.VendorActivationDate,    ServiceRequest.VendorDeactivationDate,    ServiceRequest.FOC,    ServiceRequest.FOCMet,    DisconnectSR.CancelledServiceRequestIDF,    Replace(Replace(Replace(DisconnectSR.VendorDisconnectNumber, Char(13) +    Char(10), ' '), Char(10), ' '), ',', ' ') VendorDisconnectNumber,    DisconnectSR.VendorBillingEndDate  From Part    Inner Join SimplifiedSR ServiceRequest On ServiceRequest.PartIDF = Part.PartID      And Part.SubClassName Not In ('DSC', 'CNCL', 'ETF')    Inner Join tblManagedSR On ServiceRequest.ServiceRequestID =      tblManagedSR.ManagedSRID    Inner Join Site On ServiceRequest.SiteIDF = Site.SiteID    Inner Join tblOrder Ord On OrderIDF = Ord.OrderID    Inner Join Company [Company (Vendor)] On Part.VendorCompanyIDF =      [Company (Vendor)].CompanyID    Inner Join Account On Account.AccountID = ServiceRequest.AccountIDF    Left Outer Join tblSalesOrder SalesOrder On SalesOrder.SalesOrderID =      ServiceRequest.SalesOrderIDF    Left Outer Join Person On SalesOrder.ExecutedByPersonIDF = Person.PersonID    Left Outer Join usysOrderSalesType OrderSalesType On Ord.OrderSalesTypeIDF =      OrderSalesType.OrderSalesTypeID    Left Outer Join Workcenter On Workcenter.WorkcenterID =      ServiceRequest.CurrentWorkcenterIDF    Left Outer Join DisconnectSR On ServiceRequest.ServiceRequestID =      DisconnectSR.CancelledServiceRequestIDF    Left Outer Join tblTerm On tblManagedSR.TermIDF = tblTerm.TermID    Left Outer Join usysTermLength On tblTerm.TermLengthIDF =      usysTermLength.TermLengthID    Left Outer Join Finance On ServiceRequest.ServiceRequestID =      Finance.ServiceRequestID    Left Outer Join (Select InvoiceLineItem.ServiceRequestIDF,      Min(InvoiceLineItem.ExtPrice) As ExtPrice,      Min(InvoiceLineItem.InvoiceDate) As InvoiceDate    From InvoiceLineItem    Group By InvoiceLineItem.ServiceRequestIDF) As A      On ServiceRequest.ServiceRequestID = A.ServiceRequestIDF    Left Outer Join Company [Company (Client)] On [Company (Client)].CompanyID =      Account.CustomerCompanyIDF    Left Outer Join Procurement Procurement1 On Procurement1.ServiceRequestID =      ServiceRequest.ServiceRequestID  Where Part.SubClassName Not In ('DSC', 'CNCL', 'ETF')


--Billing - Complete Finance Query - CPE - QueryID=628
--628	2021-06-09 23:00:00	Billing - Complete Finance Query - CPE	
--Select Distinct ServiceRequest.ServiceRequestID,    ServiceRequest.OrderIDF,    [Order].OrderSalesType,    ServiceRequest.SalesOrderIDF As [Sales Order],    Person.FullName As [Executed By],    SalesOrder.DateTimeExecuted,    [Company (Client)].LegalName As [Client Name],    Account.AccountID,    Account.AccountName,    Site.CxSiteNumber,    Replace(Replace(Replace(Site.SiteName, Char(13) + Char(10), ' '), Char(10),    ' '), ',', ' ') SiteName,    Site.SiteCity,    Site.SiteState,    Site.SiteZip,    ServiceRequest.CxGLCode1,    Part.ProductClassName,    Part.SubClassName,    Part.IRGNumber As PartNumber,    Replace(Replace(Replace(Part.IRGDescription, Char(13) + Char(10), ' '),    Char(10), ' '), ',', ' ') IRGDescription,    ServiceRequest.IsSRLOA As [LOA Switch?],    ServiceRequest.EnablerRoleName As [Enabler Role],    ServiceRequest.CurrentServiceRequestStatus,    ServiceRequest.MainServiceRequestStatusName,    Workcenter.WorkcenterName,    ServiceRequest.ServiceStartDate,    ServiceRequest.ServiceEndDate,    ServiceRequest.BillingStartDate,    ServiceRequest.BillingEndDate,    ServiceRequest.CompletedDateTime,    ServiceRequest.RenewalDate,    ServiceRequest.TermDaysRemaining,    Account.TermLengthName,    [Company (Vendor)].LegalName As [Vendor Name],    Part.BaseCost As [Base Cost],    Procurement.UnitCost As [Actual Cost],    Procurement.AnticipatedCost As [Anticipated Cost],    SRStatistics.SRRev As [Client Price],    ServiceRequest.BundleName,    Procurement1.ActivationDate,    Procurement1.DueDate,    Procurement1.RequestedDueDate,    ServiceRequest.VendorActivationDate,    ServiceRequest.VendorDeactivationDate,    ServiceRequest.FOC,    ServiceRequest.FOCMet,    Broadband.MTN,    CPESR.SerialNumber,    CPESR.MACAddress,    CPESR.IMEINumber,    Part.CPEMakeName,    Part.CPEModelName  From Site    Inner Join ServiceRequest On ServiceRequest.SiteIDF = Site.SiteID    Inner Join Account On Account.AccountID = ServiceRequest.AccountIDF    Inner Join Part On ServiceRequest.PartIDF = Part.PartID    Inner Join Company [Company (Vendor)] On Part.VendorCompanyIDF =      [Company (Vendor)].CompanyID    Inner Join [Order] On ServiceRequest.OrderIDF = [Order].OrderID    Left Join Finance On ServiceRequest.ServiceRequestID =      Finance.ServiceRequestID    Left Join SRAuditHistory On Finance.ServiceRequestID =      SRAuditHistory.ServiceRequestIDF    Left Join Procurement On Procurement.ServiceRequestID =      ServiceRequest.ServiceRequestID    Left Join SRStatistics On ServiceRequest.ServiceRequestID =      SRStatistics.ServiceRequestID    Left Join Company [Company (Client)] On [Company (Client)].CompanyID =      Account.CustomerCompanyIDF    Left Join SalesOrder On SalesOrder.SalesOrderID = ServiceRequest.SalesOrderIDF    Inner Join Workcenter On Workcenter.WorkcenterID =      ServiceRequest.CurrentWorkcenterIDF    Left Join Person On SalesOrder.ExecutedByPersonIDF = Person.PersonID    Left Join Procurement Procurement1 On Procurement1.ServiceRequestID =      ServiceRequest.ServiceRequestID    Left Join Broadband On Broadband.ServiceRequestID =      ServiceRequest.ServiceRequestID    Left Join CPESR On CPESR.CPESRID = ServiceRequest.ServiceRequestID  Where Not Part.SubClassName Like 'DSC' And Not Part.SubClassName Like 'CNCL' And    Not Part.SubClassName Like 'ETF' And Part.ProductClassIDF = 1

--Billing - Complete Finance Query - RLAN - QueryID=630
--630	2021-06-09 23:00:00	Billing - Complete Finance Query - RLAN
Select Distinct ServiceRequest.ServiceRequestID,    ServiceRequest.OrderIDF,    [Order].OrderSalesType,    ServiceRequest.SalesOrderIDF As [Sales Order],    Person.FullName As [Executed By],    SalesOrder.DateTimeExecuted,    [Company (Client)].LegalName As [Client Name],    Account.AccountID,    Account.AccountName,    Site.BillingSiteID,    Site.CxSiteNumber,    Replace(Replace(Replace(Site.SiteName, Char(13) + Char(10), ' '), Char(10),    ' '), ',', ' ') SiteName,    Site.SiteCity,    Site.SiteState,    Site.SiteZip,    ServiceRequest.CxGLCode1,    Part.ProductClassName,    Part.SubClassName,    Part.IRGNumber As PartNumber,    Replace(Replace(Replace(Part.IRGDescription, Char(13) + Char(10), ' '),    Char(10), ' '), ',', ' ') IRGDescription,    ServiceRequest.IsSRLOA As [LOA Switch?],    ServiceRequest.EnablerRoleName As [Enabler Role],    ServiceRequest.CurrentServiceRequestStatus,    ServiceRequest.MainServiceRequestStatusName,    Workcenter.WorkcenterName,    ServiceRequest.ServiceStartDate,    ServiceRequest.ServiceEndDate,    ServiceRequest.BillingStartDate,    ServiceRequest.BillingEndDate,    ServiceRequest.CompletedDateTime,    ServiceRequest.RenewalDate,    ServiceRequest.TermDaysRemaining,    Account.TermLengthName,    [Company (Vendor)].LegalName As [Vendor Name],    Part.BaseCost As [Base Cost],    Procurement.UnitCost As [Actual Cost],    Procurement.AnticipatedCost As [Anticipated Cost],    SRStatistics.SRRev As [Client Price],    ServiceRequest.BundleName,    Procurement1.ActivationDate,    Procurement1.DueDate,    Procurement1.RequestedDueDate,    ServiceRequest.VendorActivationDate,    ServiceRequest.VendorDeactivationDate,    ServiceRequest.FOC,    ServiceRequest.FOCMet,    Broadband.MTN,    CPESR.SerialNumber,    ProServiceSR.JobNumber  From Site    Inner Join ServiceRequest On ServiceRequest.SiteIDF = Site.SiteID    Inner Join Account On Account.AccountID = ServiceRequest.AccountIDF    Inner Join Part On ServiceRequest.PartIDF = Part.PartID    Inner Join Company [Company (Vendor)] On Part.VendorCompanyIDF =      [Company (Vendor)].CompanyID    Inner Join [Order] On ServiceRequest.OrderIDF = [Order].OrderID    Left Join Finance On ServiceRequest.ServiceRequestID =      Finance.ServiceRequestID    Left Join SRAuditHistory On Finance.ServiceRequestID =      SRAuditHistory.ServiceRequestIDF    Left Join Procurement On Procurement.ServiceRequestID =      ServiceRequest.ServiceRequestID    Left Join SRStatistics On ServiceRequest.ServiceRequestID =      SRStatistics.ServiceRequestID    Left Join Company [Company (Client)] On [Company (Client)].CompanyID =      Account.CustomerCompanyIDF    Left Join SalesOrder On SalesOrder.SalesOrderID = ServiceRequest.SalesOrderIDF    Inner Join Workcenter On Workcenter.WorkcenterID =      ServiceRequest.CurrentWorkcenterIDF    Left Join Person On SalesOrder.ExecutedByPersonIDF = Person.PersonID    Left Join Procurement Procurement1 On Procurement1.ServiceRequestID =      ServiceRequest.ServiceRequestID    Left Join Broadband On Broadband.ServiceRequestID =      ServiceRequest.ServiceRequestID    Left Join CPESR On CPESR.CPESRID = ServiceRequest.ServiceRequestID    Left Join ProServiceSR On ServiceRequest.ServiceRequestID =      ProServiceSR.ProServiceSRID  Where Not Part.SubClassName Like 'DSC' And Not Part.SubClassName Like 'CNCL' And    Not Part.SubClassName Like 'ETF' And Part.ProductClassIDF = 5

--Billing - Complete Finance Query - TMG - QueryID=625
--625	2021-06-09 23:01:00	Billing - Complete Finance Query - TMG
Select Distinct ServiceRequest.ServiceRequestID,    ServiceRequest.OrderIDF,    OrderSalesType,    ServiceRequest.SalesOrderIDF As [Sales Order]  ,    Person.FullName As [Executed By],    SalesOrder.DateTimeExecuted,    [Company (Client)].LegalName As [Client Name],    Account.AccountID  ,    Account.AccountName,    Site.BillingSiteID,    Site.CxSiteNumber,    Replace(Replace(Replace(Site.SiteName, Char(13) + Char(10), ' '), Char(10),    ' '), ',', ' ') SiteName  ,    Site.SiteAddress1,    Site.SpaceNumber,    Site.SiteCity,    Site.SiteState,    Site.SiteZip,    ServiceRequest.CxGLCode1,    Part.ProductClassName,    Part.SubClassName  ,    Part.IRGNumber As PartNumber,    Replace(Replace(Replace(Part.IRGDescription, Char(13) + Char(10), ' '),    Char(10), ' '), ',', ' ') IRGDescription  ,    ServiceRequest.IsSRLOA As [LOA Switch?],    ServiceRequest.EnablerRoleName As [Enabler Role],    ServiceRequest.CurrentServiceRequestStatus  ,    ServiceRequest.MainServiceRequestStatusName,    Workcenter.WorkcenterName,    ServiceRequest.ServiceStartDate,    ServiceRequest.ServiceEndDate  ,    ServiceRequest.BillingStartDate,    ServiceRequest.BillingEndDate,    ServiceRequest.CompletedDateTime,    ServiceRequest.RenewalDate  ,    tblTerm.StartDate As LastRenewalDate,    DateAdd(month, usysTermLength.LengthInMonths, tblTerm.StartDate) -    1 As [Term End Date]  ,    ServiceRequest.TermDaysRemaining, usysTermLength.TermLengthName SRTermLength,    [Company (Vendor)].LegalName As [Vendor Name],    Part.BaseCost As [Base Cost]  ,    Procurement.UnitCost As [Actual Cost],    Procurement.AnticipatedCost As [Anticipated Cost],    SRStatistics.SRRev As [Client Price]  ,    ServiceRequest.BundleName,    Procurement.ActivationDate,    Procurement.DueDate,    Procurement.RequestedDueDate,    ServiceRequest.VendorActivationDate  ,    ServiceRequest.VendorDeactivationDate,    ServiceRequest.FOC,    ServiceRequest.FOCMet,    Broadband.MTN,    CPESR.SerialNumber,    ServiceRequest.VendorCircuitID,    ServiceRequest.VendorOrderNumber As VendorOrder#,    Finance.VendorBTN,    Finance.VendorBillingAccountNumber As [BillingAcc.#]  ,    Finance.VendorRegionalBillingNumber As RegionalBilling#  ,    Broadband.Demarc,    Broadband.ExtendedDemarc As [Ex.Dmarc],    Broadband.HandOffMethodName,    Broadband.IPAdress  ,    Broadband.SubnetMask,    Broadband.Gateway,    Broadband.IPUsableRangeStart,    Broadband.IPUsableRangeEnd,    Broadband.DNS1,    Broadband.DNS2,    Broadband.PPPUserName  ,    Broadband.PPPPassword,    Broadband.InstalledSignalStrength As [Installed Signal]  ,    CircuitTest.SPT_Downspeed As [SPT Downspeed],    CircuitTest.SPT_Upspeed As [SPT Upspeed]  ,    Part.CxGBDataAllowance,    ServiceRequest.SOWEnablerName  From Site Inner Join SimplifiedSR ServiceRequest On ServiceRequest.SiteIDF = Site.SiteID Inner Join Account On Account.AccountID = ServiceRequest.AccountIDF Inner Join Part On ServiceRequest.PartIDF = Part.PartID And Part.ProductClassIDF =    7 Inner Join tblManagedSR On ServiceRequest.ServiceRequestID =      tblManagedSR.ManagedSRID Inner Join [Order] On OrderIDF = [Order].OrderID Left Join Broadband On Broadband.ServiceRequestID =      ServiceRequest.ServiceRequestID Left Join tblTerm On tblManagedSR.TermIDF = tblTerm.TermID Left Join usysTermLength On tblTerm.TermLengthIDF =      usysTermLength.TermLengthID Inner Join Company [Company (Vendor)] On Part.VendorCompanyIDF =      [Company (Vendor)].CompanyID Left Join Finance On ServiceRequest.ServiceRequestID =      Finance.ServiceRequestID Left Join Procurement On Procurement.ServiceRequestID =      ServiceRequest.ServiceRequestID Left Join SRStatistics On ServiceRequest.ServiceRequestID =      SRStatistics.ServiceRequestID Left Join Company [Company (Client)] On [Company (Client)].CompanyID =      Account.CustomerCompanyIDF Left Join SalesOrder On SalesOrder.SalesOrderID = ServiceRequest.SalesOrderIDF Left Join Workcenter On Workcenter.WorkcenterID =      ServiceRequest.CurrentWorkcenterIDF Left Join Person On SalesOrder.ExecutedByPersonIDF = Person.PersonID Left Join CPESR On CPESR.CPESRID = ServiceRequest.ServiceRequestID Left Join (Select LastTest.*    From (Select CircuitTest.ServiceRequestID,        CircuitTest.SPT_Downspeed,        CircuitTest.SPT_Upspeed,        Rank() Over (Partition By CircuitTest.ServiceRequestID Order By        CircuitTest.CircuitTestID Desc) Rnk      From CircuitTest) LastTest    Where LastTest.Rnk = 1) CircuitTest On CircuitTest.ServiceRequestID =      ServiceRequest.ServiceRequestID   Where Part.SubClassName Not In ('DSC', 'CNCL', 'ETF')

--Billing - Complete Finance Query w. Audit History - QueryID=3072
--3072	2021-06-09 23:04:00	Billing - Complete Finance Query w. Audit History
Select Distinct Site.CxSiteNumber ,    Site.SiteName ,    CktSR.AccountIDF ,    [Order].SiteTypeName ,    [Order].OrderID ,    CktSR.ServiceRequestID ,    CktSR.CurrentServiceRequestStatus ,    CktSR.EnablerRoleName ,    CktPart.IRGNumber ,    CktPart.ShortDescription ,    Broadband.FOC ,    Broadband.FOCMet ,    [Install SR].ScheduledDateTime As [CI Scheduled] ,    [Install SR].CompletedDateTime As [CI Complete] ,    Broadband.VendorCircuitID ,    Broadband.Demarc ,    Broadband.HandOffMethodName ,    Broadband.IPAdress ,    Broadband.SubnetMask ,    Broadband.Gateway ,    Broadband.IPUsableRangeStart ,    Broadband.IPUsableRangeEnd ,    Broadband.DNS1 ,    Broadband.DNS2 ,    Broadband.PPPUserName ,    Broadband.PPPPassword ,    [CPE SR].CPEMakeName ,    [CPE SR].CPEModelName ,    [CPE SR].SerialNumber ,    [DBU SR].Username As DBU_Username ,    [DBU SR].Password As DBU_Password ,    [DBU SR].DialOut1 As DBU_Dialout1 ,    [DBU SR].DialOut2 As DBU_Dialout2 ,    SRLastJournal.LastJournal ,    SRLastJournal.LastUpdated As [Last Journal Date] ,    CktSR.BillingEndDate ,    CktSR.SalesOrderIDF ,    Company.LegalName As Carrier   FROM Site     INNER Join SimplifiedSR  CktSR On CktSR.SiteIDF = Site.SiteID     Left Join SRLastJournal SRLastJournal    On CktSR.ServiceRequestID = SRLastJournal.ServiceRequestID    AND SRLastJournal.AuthorizedToIDF = 2 INNER Join Account On CktSR.AccountIDF = Account.AccountID     INNER Join Part CktPart On CktSR.PartIDF = CktPart.PartID     Left Join Broadband On CktSR.ServiceRequestID = Broadband.ServiceRequestID     INNER Join [Order] On [Order].OrderID = CktSR.OrderIDF     Left Join (Select Site.CxSiteNumber ,      ServiceRequest.OrderIDF ,      ServiceRequest.ServiceRequestID ,      ServiceRequest.ScheduledDateTime ,      ServiceRequest.CompletedDateTime ,      ServiceRequest.VendorCompanyIDF FROM SimplifiedSR ServiceRequest  INNER Join Site On ServiceRequest.SiteIDF = Site.SiteID  Where ServiceRequest.VendorCompanyIDF <> 304 And      ServiceRequest.VendorCompanyIDF <> 361 And ServiceRequest.VendorCompanyIDF      <> 4692 And ServiceRequest.VendorCompanyIDF <> 4693 And      (ServiceRequest.SubClassIDF = 39 Or ServiceRequest.SubClassIDF =        40) AND ServiceRequest.AccountIDF In (1000001045, 1000001026, 1000001001, 1000000996,    1000000988, 1000000993, 1000000903, 1000001052, 1000001092, 1000001102)  ) [Install SR] On CktSR.OrderIDF = [Install SR].OrderIDF And      CktSR.VendorCompanyIDF = [Install SR].VendorCompanyIDF     Left Join (Select Site.CxSiteNumber ,      ServiceRequest.OrderIDF ,      ServiceRequest.ServiceRequestID ,      Part.CPEMakeName ,      Part.CPEModelName ,      CPESR.SerialNumber ,      ServiceRequest.VendorCompanyIDF     FROM SimplifiedSR ServiceRequest       INNER Join Site On ServiceRequest.SiteIDF = Site.SiteID       Left Join CPESR On ServiceRequest.ServiceRequestID = CPESR.CPESRID       INNER Join Part On ServiceRequest.PartIDF = Part.PartID Where ServiceRequest.SubClassIDF = 165 AND ServiceRequest.AccountIDF In (1000001045, 1000001026, 1000001001, 1000000996,    1000000988, 1000000993, 1000000903, 1000001052, 1000001092, 1000001102)   ) [CPE SR] On CktSR.OrderIDF =      [CPE SR].OrderIDF And CktSR.VendorCompanyIDF = [CPE SR].VendorCompanyIDF     Left Join (Select Site.CxSiteNumber ,      ServiceRequest.OrderIDF ,      ServiceRequest.ServiceRequestID ,      DBUSR.Username ,      DBUSR.Password ,      DBUSR.DialOut1 ,      DBUSR.DialOut2 ,      ServiceRequest.EnablerRoleName     FROM SimplifiedSR ServiceRequest       INNER Join Site On ServiceRequest.SiteIDF = Site.SiteID       INNER Join DBUSR On ServiceRequest.ServiceRequestID =        DBUSR.ServiceRequestID ) [DBU SR] On Site.CxSiteNumber =      [DBU SR].CxSiteNumber And CktSR.EnablerRoleName = [DBU SR].EnablerRoleName     INNER Join Company On CktSR.VendorCompanyIDF = Company.CompanyID Where CktSR.AccountIDF In (1000001045, 1000001026, 1000001001, 1000000996,    1000000988, 1000000993, 1000000903, 1000001052, 1000001092, 1000001102)  And CktSR.CurrentServiceRequestStatus Not Like '%changed%'  And    CktSR.CurrentServiceRequestStatus Not Like '%disc%'  And    CktSR.CurrentServiceRequestStatus Not Like '%canc%'  And    CktPart.IsCircuitPart = 1  Order By Site.CxSiteNumber ,    CktSR.EnablerRoleName

--SAR Daily Report - QueryID=36
--36	2017-04-10 09:59:00	SAR Daily Report
Select [Order].OrderID     ,  [Order].PriorityName     ,  [Order].CxRequestedDate     ,  [Order].CurrentOrderStatus     ,  Account.AccountName  ,  Site.SiteName     ,  Site.CxSiteNumber     ,  Site.SiteAddress1     ,  Site.SpaceNumber     ,  Site.SiteAddress2     ,  Site.SiteCity     ,  Site.SiteState  ,  Site.SiteZip     ,  Site.LocalTN     ,  ServiceRequest.ServiceRequestID     ,  ServiceRequest.ServiceRequestTypeName     ,  Workcenter.WorkcenterName  ,  Company.LegalName As Vendor     ,  Part.IRGNumber As [Part Num]     ,  Part.IRGDescription As [Part Desc]     ,  ServiceRequest.FOC  ,  ServiceRequest.FOCMet     ,  ServiceRequest.ScheduledDateTime As [CI Date]     ,  ServiceRequest.ScheduledInstallTimeSlotName As [CI Arrival Window]  ,  ServiceRequest.CurrentServiceRequestStatus     ,  TaskException.ExceptionDateCreated As [Date Created]     ,  TaskException.ExceptionNotes  ,  ServiceRequest.LastUpdatedDatetime     ,  DateDiff(d, ServiceRequest.LastUpdatedDatetime, GetDate()) As NumberOfDaysInCurrentStatus   , PrerequisiteSR.RlanSr 'Carrier RLAN SRID'     , PrerequisiteSR.CPESr 'Carrier CPE SRID'   , SRLastJournal.LastJournal As IRGViewableLastJournal     FROM Account   INNER JOIN Site On Account.AccountID = Site.AccountIDF    INNER JOIN [Order] On Site.SiteID = [Order].SiteIDF    INNER JOIN SimplifiedSR ServiceRequest On [Order].OrderID = ServiceRequest.OrderIDF AND ServiceRequest.AccountIDF = Account.AccountID    Left Join SRLastJournal On SRLastJournal.ServiceRequestID =      ServiceRequest.ServiceRequestID And SRLastJournal.AuthorizedToIDF = 1   INNER JOIN Workcenter On ServiceRequest.CurrentWorkcenterIDF = Workcenter.WorkcenterID   INNER JOIN Part On ServiceRequest.PartIDF = Part.PartID    INNER JOIN Company On Part.VendorCompanyIDF = Company.CompanyID    INNER JOIN TaskException On ServiceRequest.ServiceRequestID = TaskException.ServiceRequestIDF  AND ServiceRequest.CurrentServiceRequestStatusIDF  = TaskException.ServiceRequestStatusIDF   AND WorkFlowExceptionID is not null     LEFT OUTER JOIN   (   Select distinct DependentServiceRequestIDF    , CPESr.ServiceRequestID CPESr    , RlanSr.ServiceRequestID RlanSr     FROM    (    Select distinct DependentServiceRequestIDF     FROM tblPrerequisiteServiceRequest (nolock)  ) PrerequisiteServiceRequest    OUTER APPLY    (    Select ServiceRequestID         FROM tblServiceRequest  (nolock)          INNER JOIN tblPart CPESrPart (nolock) on PartIDF = CPESrPart.PartID    INNER JOIN tblSubClass CPESrPartSubClass (nolock) on SubClassIDF = CPESrPartSubClass.SubClassID     and CPESrPartSubClass.ProductClassIDF = 1          INNER JOIN tblPrerequisiteServiceRequest cpePrerequisiteServiceRequest (nolock)     on ServiceRequestID = SupportingServiceRequestIDF      WHERE PrerequisiteServiceRequest.DependentServiceRequestIDF = cpePrerequisiteServiceRequest.DependentServiceRequestIDF    ) CPESr     OUTER APPLY   (        Select ServiceRequestID    FROM tblServiceRequest (nolock)     INNER JOIN tblPart  RlanSrPart (nolock) on PartIDF = RlanSrPart.PartID     INNER JOIN tblSubClass  RlanSrPartSubClass (nolock) on SubClassIDF = RlanSrPartSubClass.SubClassID     and RlanSrPartSubClass.ProductClassIDF = 5          INNER JOIN tblPrerequisiteServiceRequest RlanPrerequisiteServiceRequest (nolock)      on ServiceRequestID = SupportingServiceRequestIDF        WHERE PrerequisiteServiceRequest.DependentServiceRequestIDF = RlanPrerequisiteServiceRequest.DependentServiceRequestIDF           ) RlanSr       )PrerequisiteSR   on ServiceRequest.ServiceRequestID = PrerequisiteSR.DependentServiceRequestIDF WHERE CurrentWorkcenterIDF = 23

--Procurement – New Orders - QueryID=89
--89	2018-11-19 13:49:00	Procurement - New Orders
Select Distinct Company.LegalName As Company,    ServiceRequest.AccountIDF,    ServiceRequest.SalesOrderIDF,    SalesOrder.DateTimeExecuted,    Site.SiteName,    Site.CxSiteNumber,    Site.SiteAddress1,    Site.SpaceNumber,    Site.SiteAddress2,    Site.SiteCity,    Site.SiteState,    Site.SiteZip,    Site.LocalTN,    Site.DSLTN,    ServiceRequest.OrderIDF,    [Order].SiteTypeName,    [Order].CurrentOrderStatus,    RENT.ServiceRequestID As [RENT SRID],    Workcenter.WorkcenterName,    ServiceRequest.ServiceRequestID,    RLAN.ServiceRequestID As [Carrier RLAN SRID],    CPE.ServiceRequestID As [Carrier CPE SRID],    ServiceRequest.IsSRLOA As [LOA?],    ServiceRequest.CurrentServiceRequestStatus,    TaskException.ExceptionNotes,    TaskException.ExceptionScheduleDate,    TaskException.ExceptionDateCreated,    TaskException.ExceptionLastUpdated,    ServiceRequest.VendorOrderNumber,    ServiceRequest.VendorCircuitID,    Part.ProductClassName,    Part.IRGDescription,    Vendor.LegalName As Vendor,    [Order].PriorityName,    [Order].CxRequestedDate,    IRGLastJournal.LastJournal,    Part.SubClassName,    Part.TermLengthName As Term,    ServiceRequest.SOWEnablerName  From Account    Inner Join Company On Company.CompanyID = Account.CustomerCompanyIDF    Inner Join ServiceRequest On Account.AccountID = ServiceRequest.AccountIDF    Inner Join Part On ServiceRequest.PartIDF = Part.PartID    Inner Join Company Vendor On Part.VendorCompanyIDF = Vendor.CompanyID    Inner Join Workcenter On ServiceRequest.CurrentWorkcenterIDF =      Workcenter.WorkcenterID    Inner Join [Order] On [Order].OrderID = ServiceRequest.OrderIDF    Inner Join Site On Site.SiteID = ServiceRequest.SiteIDF    Left Join (Select SalesOrder.SalesOrderID,      SalesOrder.DateTimeExecuted,      SalesOrder.SalesOrderStatusName,      Person.LastName    From SalesOrder      Inner Join Person On SalesOrder.ExecutedByPersonIDF = Person.PersonID    Where Not SalesOrder.SalesOrderTypeName Like '%Change%') SalesOrder      On ServiceRequest.SalesOrderIDF = SalesOrder.SalesOrderID    Left Join (Select Distinct ServiceRequest.ServiceRequestID,      ServiceRequest.OrderIDF    From ServiceRequest    Where ServiceRequest.ProductClassIDF = 5 And ServiceRequest.WorkcenterName =      'Procurement') RLAN On ServiceRequest.OrderIDF = RLAN.OrderIDF    Left Join (Select Distinct ServiceRequest.ServiceRequestID,      ServiceRequest.OrderIDF    From ServiceRequest      Inner Join vSubClass On ServiceRequest.SubClassIDF = vSubClass.subclassid    Where ServiceRequest.ProductClassIDF = 1 And subclassname Like '%CAR%' And      workcentername = 'Procurement') CPE On ServiceRequest.OrderIDF =      CPE.OrderIDF    Left Join (Select Distinct Site.CxSiteNumber,      ServiceRequest.ServiceRequestID    From ServiceRequest      Inner Join Site On ServiceRequest.SiteIDF = Site.SiteID    Where ServiceRequest.ProductClassIDF = 7 And ServiceRequest.SubClassIDF =      159) RENT On Site.CxSiteNumber = RENT.CxSiteNumber    Left Join TaskException On ServiceRequest.ServiceRequestID =      TaskException.ServiceRequestIDF And      ServiceRequest.CurrentServiceRequestStatusIDF =      TaskException.ServiceRequestStatusIDF    Left Join (Select SRLastJournal.LastJournal,      SRLastJournal.ServiceRequestID    From SRLastJournal    Where SRLastJournal.AuthorizedToIDF = 1) IRGLastJournal      On ServiceRequest.ServiceRequestID = IRGLastJournal.ServiceRequestID  Where Workcenter.WorkcenterName Like 'procure%' And    Not ServiceRequest.CurrentServiceRequestStatus Like '%Disconnect%' And    Not ServiceRequest.CurrentServiceRequestStatus Like '%Cancellation%'    And Not ServiceRequest.CurrentServiceRequestStatus Like '%Change%' And    Part.ProductClassName Like 'tmg'  Union All  Select Distinct Company.LegalName As Company,    ServiceRequest.AccountIDF,    ServiceRequest.SalesOrderIDF,    SalesOrder.DateTimeExecuted,    Site.SiteName,    Site.CxSiteNumber,    Site.SiteAddress1,    Site.SpaceNumber,    Site.SiteAddress2,    Site.SiteCity,    Site.SiteState,    Site.SiteZip,    Site.LocalTN,    Site.DSLTN,    ServiceRequest.OrderIDF,    [Order].SiteTypeName,    [Order].CurrentOrderStatus,    RENT.ServiceRequestID As [RENT SRID],    Workcenter.WorkcenterName,    ServiceRequest.ServiceRequestID,    RLAN.ServiceRequestID As [Carrier RLAN SRID],    CPE.ServiceRequestID As [Carrier CPE SRID],    ServiceRequest.IsSRLOA As [LOA?],    ServiceRequest.CurrentServiceRequestStatus,    TaskException.ExceptionNotes,    TaskException.ExceptionScheduleDate,    TaskException.ExceptionDateCreated,    TaskException.ExceptionLastUpdated,    ServiceRequest.VendorOrderNumber,    ServiceRequest.VendorCircuitID,    Part.ProductClassName,    Part.IRGDescription,    Vendor.LegalName As Vendor,    [Order].PriorityName,    [Order].CxRequestedDate,    IRGLastJournal.LastJournal,    Part.SubClassName,    Part.TermLengthName As Term,    ServiceRequest.SOWEnablerName  From Account    Inner Join Company On Company.CompanyID = Account.CustomerCompanyIDF    Inner Join ServiceRequest On Account.AccountID = ServiceRequest.AccountIDF    Inner Join Part On ServiceRequest.PartIDF = Part.PartID    Inner Join Company Vendor On Part.VendorCompanyIDF = Vendor.CompanyID    Inner Join Workcenter On ServiceRequest.CurrentWorkcenterIDF =      Workcenter.WorkcenterID    Inner Join [Order] On [Order].OrderID = ServiceRequest.OrderIDF    Inner Join Site On Site.SiteID = ServiceRequest.SiteIDF    Left Join (Select SalesOrder.SalesOrderID,      SalesOrder.DateTimeExecuted,      SalesOrder.SalesOrderStatusName,      Person.LastName    From SalesOrder      Inner Join Person On SalesOrder.ExecutedByPersonIDF = Person.PersonID    Where Not SalesOrder.SalesOrderTypeName Like '%Change%') SalesOrder      On ServiceRequest.SalesOrderIDF = SalesOrder.SalesOrderID    Left Join (Select Distinct ServiceRequest.ServiceRequestID,      ServiceRequest.OrderIDF    From ServiceRequest    Where ServiceRequest.ProductClassIDF = 5 And ServiceRequest.WorkcenterName =      'Procurement') RLAN On ServiceRequest.OrderIDF = RLAN.OrderIDF    Left Join (Select Distinct ServiceRequest.ServiceRequestID,      ServiceRequest.OrderIDF    From ServiceRequest      Inner Join vSubClass On ServiceRequest.SubClassIDF = vSubClass.subclassid    Where ServiceRequest.ProductClassIDF = 1 And subclassname Like '%CAR%' And      workcentername = 'Procurement') CPE On ServiceRequest.OrderIDF =      CPE.OrderIDF    Left Join (Select Distinct Site.CxSiteNumber,      ServiceRequest.ServiceRequestID    From ServiceRequest      Inner Join Site On ServiceRequest.SiteIDF = Site.SiteID    Where ServiceRequest.ProductClassIDF = 7 And ServiceRequest.SubClassIDF =      159) RENT On Site.CxSiteNumber = RENT.CxSiteNumber    Left Join TaskException On ServiceRequest.ServiceRequestID =      TaskException.ServiceRequestIDF And      ServiceRequest.CurrentServiceRequestStatusIDF =      TaskException.ServiceRequestStatusIDF    Left Join (Select SRLastJournal.LastJournal,      SRLastJournal.ServiceRequestID    From SRLastJournal    Where SRLastJournal.AuthorizedToIDF = 1) IRGLastJournal      On ServiceRequest.ServiceRequestID = IRGLastJournal.ServiceRequestID  Where (Workcenter.WorkcenterName Like 'procure%' And    Not ServiceRequest.CurrentServiceRequestStatus Like '%Disconnect%' And    Not ServiceRequest.CurrentServiceRequestStatus Like '%Cancellation%'    And Not ServiceRequest.CurrentServiceRequestStatus Like '%Change%' And    Part.ProductClassName Like 'cpe' And Part.IRGNumber Like '%3pa%') Or    (Workcenter.WorkcenterName Like 'procure%' And    Not ServiceRequest.CurrentServiceRequestStatus Like '%Disconnect%' And    Not ServiceRequest.CurrentServiceRequestStatus Like '%Cancellation%'    And Not ServiceRequest.CurrentServiceRequestStatus Like '%Change%' And    Part.ProductClassName Like '%RLAN%' And Part.IRGNumber Like '%fb%') Or    (Workcenter.WorkcenterName Like 'procure%' And    Not ServiceRequest.CurrentServiceRequestStatus Like '%Disconnect%' And    Not ServiceRequest.CurrentServiceRequestStatus Like '%Cancellation%'    And Not ServiceRequest.CurrentServiceRequestStatus Like '%Change%' And    Part.ProductClassName Like '%RLAN%' And Part.PartID In (291000, 287189,    292580, 292583, 292808)) Or    (Workcenter.WorkcenterName Like 'procure%' And    Not ServiceRequest.CurrentServiceRequestStatus Like '%Disconnect%' And    Not ServiceRequest.CurrentServiceRequestStatus Like '%Cancellation%'    And Not ServiceRequest.CurrentServiceRequestStatus Like '%Change%' And    Part.ProductClassName Like 'cpe' And Part.IRGNumber Like '%car%' And    [Order].OrderID <> ServiceRequest.OrderIDF)  Order By AccountIDF,    OrderIDF

--Procurement – Disco/Cancel - QueryID=135
--135	2018-11-19 13:47:00	Procurement - Disco and Cancel Orders
Select Company.LegalName As [Client Name],    Account.AccountName,    Site.SiteName,    Site.CxSiteNumber,    Site.SiteAddress1,    Site.SpaceNumber,    Site.SiteAddress2,    Site.SiteCity,    Site.SiteState,    Site.SiteZip,    [Order].OrderID,    OriginatingSRVendor.LegalName As [Carrier Name],    OriginatingSR.IRGDescription    ,OriginatingSRPart.SubClassName Subclass    ,OriginatingSR.VendorOrderNumber,    OriginatingSR.VendorCircuitID,    ServiceRequest.IsSRLOA As [LOA?],    [Order].CurrentOrderStatus,    ServiceRequest.ServiceRequestID,    ServiceRequest.CurrentServiceRequestStatus,    DisconnectSR.RequestedDiscoDate,    DisconnectSR.RequestedCancelDate,    DisconnectSR.DateSubmittedToVendor,    DisconnectSR.ReturnTicketNumber,    DisconnectSR.VendorDisconnectNumber,    ServiceRequest.IRGDescription,    ServiceRequest.SOWEnablerName   ,DisconnectSR.DisconnectReasonName DiscoReasonName   ,DisconnectSR.CancellationReasonName CancelReasonName   ,RequestedByPerson.PersonEmail1 SubmittedBy   ,DisconnectSR.NotesFromCustomer DiscoNotes  From SimplifiedSR ServiceRequest     Inner Join Account On Account.AccountID = ServiceRequest.AccountIDF And ServiceRequest.CurrentWorkcenterIDF = 12    Inner Join Company On Company.CompanyID = Account.CustomerCompanyIDF    Inner Join Part On ServiceRequest.PartIDF = Part.PartID And Part.ProductClassIDF = 5 And Part.SubClassIDF In (168, 162)    Inner Join Company Vendor  On Part.VendorCompanyIDF = Vendor.CompanyID    Inner Join Site On Site.SiteID = ServiceRequest.SiteIDF And Site.AccountIDF = ServiceRequest.AccountIDF    Left Join [Order] On [Order].OrderID = ServiceRequest.OrderIDF    Left Join DisconnectSR On DisconnectSR.DisconnectID = ServiceRequest.ServiceRequestID    Left Join SimplifiedSR OriginatingSR  On ServiceRequest.OriginatingSR = OriginatingSR.ServiceRequestID    Left Join Part OriginatingSRPart  On OriginatingSR.PartIDF = OriginatingSRPart.PartID    Left Join Company OriginatingSRVendor  On OriginatingSRPart.VendorCompanyIDF = OriginatingSRVendor.CompanyID    Left Join (Select DISTINCT PersonID, PersonEmail1 FROM Person) RequestedByPerson On DisconnectSR.RequestedByPersonIDF = RequestedByPerson.PersonID         Where ServiceRequest.CurrentServiceRequestStatus Not In ('Disconnected',    'Changed - Disconnected', 'Pending Cancellation', 'Changed',    'Pending Change Order', 'Changed - Disconnected', 'CHG:Pending Change Reques',    'CHG:MNS Change Complete')

--Procurement – New Orders ALL - QueryID=147
--147	2014-05-06 08:55:00	Procurement - New Orders ALL
Select Distinct Company.LegalName As Company,    Account.AccountName,    ServiceRequest.AccountIDF,    ServiceRequest.SalesOrderIDF,    SalesOrder.SalesOrderStatusName,    SalesOrder.DateTimeExecuted,    SalesOrder.LastName,    Site.SiteName,    Site.CxSiteNumber,    Site.SiteAddress1,    Site.SpaceNumber,    Site.SiteAddress2,    Site.SiteCity,    Site.SiteState,    Site.SiteZip,    Site.LocalTN,    Site.DSLTN,    [Order].OrderID,    [Order].SiteTypeName,    [Order].PriorityName,    [Order].CurrentOrderStatus,    Workcenter.WorkcenterName,    ServiceRequest.ServiceRequestID,    ServiceRequest.CurrentServiceRequestStatus,    TaskException.ExceptionScheduleDate,    TaskException.ExceptionNotes,    TaskException.ExceptionDateCreated,    TaskException.ExceptionLastUpdated,    ServiceRequest.VendorOrderNumber,    ServiceRequest.VendorCircuitID,    Part.ProductClassName,    Part.IRGNumber,    Part.IRGDescription,    Vendor.LegalName As Vendor,    DateDiff(d, ServiceRequest.LastUpdatedDatetime, GetDate()) As    NumberOfDaysInCurrentStatus  From Company    Inner Join Account On Company.CompanyID = Account.CustomerCompanyIDF    Right Join ServiceRequest On Account.AccountID = ServiceRequest.AccountIDF    Left Join [Order] On [Order].OrderID = ServiceRequest.OrderIDF    Inner Join Part On ServiceRequest.PartIDF = Part.PartID    Inner Join Company Vendor On Part.VendorCompanyIDF = Vendor.CompanyID    Inner Join Workcenter On ServiceRequest.CurrentWorkcenterIDF =      Workcenter.WorkcenterID    Left Join Site On Site.SiteID = ServiceRequest.SiteIDF    Left Join (Select SalesOrder.SalesOrderID,      SalesOrder.DateTimeExecuted,      SalesOrder.SalesOrderStatusName,      Person.LastName    From SalesOrder      Inner Join Person On SalesOrder.ExecutedByPersonIDF = Person.PersonID    Where Not SalesOrder.SalesOrderTypeName Like '%Change%') SalesOrder      On ServiceRequest.SalesOrderIDF = SalesOrder.SalesOrderID    Left Join TaskException On ServiceRequest.ServiceRequestID =      TaskException.ServiceRequestIDF And      ServiceRequest.CurrentServiceRequestStatusIDF =      TaskException.ServiceRequestStatusIDF  Where Workcenter.WorkcenterName Like 'procure%' And    ServiceRequest.CurrentServiceRequestStatus Not Like '%Disconnect%' And    ServiceRequest.CurrentServiceRequestStatus Not Like '%Cancellation%'    And ServiceRequest.CurrentServiceRequestStatus Not Like '%Change%'  Order By Account.AccountName,    [Order].OrderID,    Part.ProductClassName




----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

if(select LastUpdated from tblQuery where queryid = 36) = '2017-04-10 09:59:00'
	update tblQuery
	set TSQLText = 'Select [Order].OrderID  ,  [Order].OrderSalesType,  [Order].BillingType   ,  [Order].PriorityName     ,  [Order].CxRequestedDate     ,  [Order].CurrentOrderStatus     ,  Account.AccountName  ,  Site.SiteName     ,  Site.CxSiteNumber     ,  Site.SiteAddress1     ,  Site.SpaceNumber     ,  Site.SiteAddress2     ,  Site.SiteCity     ,  Site.SiteState  ,  Site.SiteZip     ,  Site.LocalTN     ,  ServiceRequest.ServiceRequestID     ,  ServiceRequest.ServiceRequestTypeName     ,  Workcenter.WorkcenterName  ,  Company.LegalName As Vendor     ,  Part.IRGNumber As [Part Num]     ,  Part.IRGDescription As [Part Desc]     ,  ServiceRequest.FOC  ,  ServiceRequest.FOCMet     ,  ServiceRequest.ScheduledDateTime As [CI Date]     ,  ServiceRequest.ScheduledInstallTimeSlotName As [CI Arrival Window]  ,  ServiceRequest.CurrentServiceRequestStatus     ,  TaskException.ExceptionDateCreated As [Date Created]     ,  TaskException.ExceptionNotes  ,  ServiceRequest.LastUpdatedDatetime     ,  DateDiff(d, ServiceRequest.LastUpdatedDatetime, GetDate()) As NumberOfDaysInCurrentStatus   , PrerequisiteSR.RlanSr ''Carrier RLAN SRID''     , PrerequisiteSR.CPESr ''Carrier CPE SRID''   , SRLastJournal.LastJournal As IRGViewableLastJournal     FROM Account   INNER JOIN Site On Account.AccountID = Site.AccountIDF    INNER JOIN [Order] On Site.SiteID = [Order].SiteIDF    INNER JOIN SimplifiedSR ServiceRequest On [Order].OrderID = ServiceRequest.OrderIDF AND ServiceRequest.AccountIDF = Account.AccountID    Left Join SRLastJournal On SRLastJournal.ServiceRequestID =      ServiceRequest.ServiceRequestID And SRLastJournal.AuthorizedToIDF = 1   INNER JOIN Workcenter On ServiceRequest.CurrentWorkcenterIDF = Workcenter.WorkcenterID   INNER JOIN Part On ServiceRequest.PartIDF = Part.PartID    INNER JOIN Company On Part.VendorCompanyIDF = Company.CompanyID    INNER JOIN TaskException On ServiceRequest.ServiceRequestID = TaskException.ServiceRequestIDF  AND ServiceRequest.CurrentServiceRequestStatusIDF  = TaskException.ServiceRequestStatusIDF   AND WorkFlowExceptionID is not null     LEFT OUTER JOIN   (   Select distinct DependentServiceRequestIDF    , CPESr.ServiceRequestID CPESr    , RlanSr.ServiceRequestID RlanSr     FROM    (    Select distinct DependentServiceRequestIDF     FROM tblPrerequisiteServiceRequest (nolock)  ) PrerequisiteServiceRequest    OUTER APPLY    (    Select ServiceRequestID         FROM tblServiceRequest  (nolock)          INNER JOIN tblPart CPESrPart (nolock) on PartIDF = CPESrPart.PartID    INNER JOIN tblSubClass CPESrPartSubClass (nolock) on SubClassIDF = CPESrPartSubClass.SubClassID     and CPESrPartSubClass.ProductClassIDF = 1          INNER JOIN tblPrerequisiteServiceRequest cpePrerequisiteServiceRequest (nolock)     on ServiceRequestID = SupportingServiceRequestIDF      WHERE PrerequisiteServiceRequest.DependentServiceRequestIDF = cpePrerequisiteServiceRequest.DependentServiceRequestIDF    ) CPESr     OUTER APPLY   (        Select ServiceRequestID    FROM tblServiceRequest (nolock)     INNER JOIN tblPart  RlanSrPart (nolock) on PartIDF = RlanSrPart.PartID     INNER JOIN tblSubClass  RlanSrPartSubClass (nolock) on SubClassIDF = RlanSrPartSubClass.SubClassID     and RlanSrPartSubClass.ProductClassIDF = 5          INNER JOIN tblPrerequisiteServiceRequest RlanPrerequisiteServiceRequest (nolock)      on ServiceRequestID = SupportingServiceRequestIDF        WHERE PrerequisiteServiceRequest.DependentServiceRequestIDF = RlanPrerequisiteServiceRequest.DependentServiceRequestIDF           ) RlanSr       )PrerequisiteSR   on ServiceRequest.ServiceRequestID = PrerequisiteSR.DependentServiceRequestIDF WHERE CurrentWorkcenterIDF = 23'
	where QueryID = 36
else
	begin 
		select 'Update Failed queryid = 36, SAR Daily Report'
		select QueryID, QueryName,  TSQLText from tblQuery where QueryID = 36
	end
if(select LastUpdated from tblQuery where queryid = 89) = '2018-11-19 13:49:00'
	update tblQuery
	set TSQLText = 'Select [Order].OrderID  ,  [Order].OrderSalesType,  [Order].BillingType   ,  [Order].PriorityName     ,  [Order].CxRequestedDate     ,  [Order].CurrentOrderStatus     ,  Account.AccountName  ,  Site.SiteName     ,  Site.CxSiteNumber     ,  Site.SiteAddress1     ,  Site.SpaceNumber     ,  Site.SiteAddress2     ,  Site.SiteCity     ,  Site.SiteState  ,  Site.SiteZip     ,  Site.LocalTN     ,  ServiceRequest.ServiceRequestID     ,  ServiceRequest.ServiceRequestTypeName     ,  Workcenter.WorkcenterName  ,  Company.LegalName As Vendor     ,  Part.IRGNumber As [Part Num]     ,  Part.IRGDescription As [Part Desc]     ,  ServiceRequest.FOC  ,  ServiceRequest.FOCMet     ,  ServiceRequest.ScheduledDateTime As [CI Date]     ,  ServiceRequest.ScheduledInstallTimeSlotName As [CI Arrival Window]  ,  ServiceRequest.CurrentServiceRequestStatus     ,  TaskException.ExceptionDateCreated As [Date Created]     ,  TaskException.ExceptionNotes  ,  ServiceRequest.LastUpdatedDatetime     ,  DateDiff(d, ServiceRequest.LastUpdatedDatetime, GetDate()) As NumberOfDaysInCurrentStatus   , PrerequisiteSR.RlanSr ''Carrier RLAN SRID''     , PrerequisiteSR.CPESr ''Carrier CPE SRID''   , SRLastJournal.LastJournal As IRGViewableLastJournal     FROM Account   INNER JOIN Site On Account.AccountID = Site.AccountIDF    INNER JOIN [Order] On Site.SiteID = [Order].SiteIDF    INNER JOIN SimplifiedSR ServiceRequest On [Order].OrderID = ServiceRequest.OrderIDF AND ServiceRequest.AccountIDF = Account.AccountID    Left Join SRLastJournal On SRLastJournal.ServiceRequestID =      ServiceRequest.ServiceRequestID And SRLastJournal.AuthorizedToIDF = 1   INNER JOIN Workcenter On ServiceRequest.CurrentWorkcenterIDF = Workcenter.WorkcenterID   INNER JOIN Part On ServiceRequest.PartIDF = Part.PartID    INNER JOIN Company On Part.VendorCompanyIDF = Company.CompanyID    INNER JOIN TaskException On ServiceRequest.ServiceRequestID = TaskException.ServiceRequestIDF  AND ServiceRequest.CurrentServiceRequestStatusIDF  = TaskException.ServiceRequestStatusIDF   AND WorkFlowExceptionID is not null     LEFT OUTER JOIN   (   Select distinct DependentServiceRequestIDF    , CPESr.ServiceRequestID CPESr    , RlanSr.ServiceRequestID RlanSr     FROM    (    Select distinct DependentServiceRequestIDF     FROM tblPrerequisiteServiceRequest (nolock)  ) PrerequisiteServiceRequest    OUTER APPLY    (    Select ServiceRequestID         FROM tblServiceRequest  (nolock)          INNER JOIN tblPart CPESrPart (nolock) on PartIDF = CPESrPart.PartID    INNER JOIN tblSubClass CPESrPartSubClass (nolock) on SubClassIDF = CPESrPartSubClass.SubClassID     and CPESrPartSubClass.ProductClassIDF = 1          INNER JOIN tblPrerequisiteServiceRequest cpePrerequisiteServiceRequest (nolock)     on ServiceRequestID = SupportingServiceRequestIDF      WHERE PrerequisiteServiceRequest.DependentServiceRequestIDF = cpePrerequisiteServiceRequest.DependentServiceRequestIDF    ) CPESr     OUTER APPLY   (        Select ServiceRequestID    FROM tblServiceRequest (nolock)     INNER JOIN tblPart  RlanSrPart (nolock) on PartIDF = RlanSrPart.PartID     INNER JOIN tblSubClass  RlanSrPartSubClass (nolock) on SubClassIDF = RlanSrPartSubClass.SubClassID     and RlanSrPartSubClass.ProductClassIDF = 5          INNER JOIN tblPrerequisiteServiceRequest RlanPrerequisiteServiceRequest (nolock)      on ServiceRequestID = SupportingServiceRequestIDF        WHERE PrerequisiteServiceRequest.DependentServiceRequestIDF = RlanPrerequisiteServiceRequest.DependentServiceRequestIDF           ) RlanSr       )PrerequisiteSR   on ServiceRequest.ServiceRequestID = PrerequisiteSR.DependentServiceRequestIDF WHERE CurrentWorkcenterIDF = 23'
	where QueryID = 89
else
	begin 
		select 'Update Failed queryid = 89, Procurement - New Orders'
		select QueryID, QueryName,  TSQLText from tblQuery where QueryID = 89
	end
if(select LastUpdated from tblQuery where queryid = 135) = '2018-11-19 13:47:00'
	update tblQuery
	set TSQLText = 'Select Company.LegalName As [Client Name],    Account.AccountName,    Site.SiteName,    Site.CxSiteNumber,    Site.SiteAddress1,    Site.SpaceNumber,    Site.SiteAddress2,    Site.SiteCity,    Site.SiteState,    Site.SiteZip,    [Order].OrderID, [Order].OrderSalesType,[Order].BillingType,   OriginatingSRVendor.LegalName As [Carrier Name],    OriginatingSR.IRGDescription    ,OriginatingSRPart.SubClassName Subclass    ,OriginatingSR.VendorOrderNumber,    OriginatingSR.VendorCircuitID,    ServiceRequest.IsSRLOA As [LOA?],    [Order].CurrentOrderStatus,    ServiceRequest.ServiceRequestID,    ServiceRequest.CurrentServiceRequestStatus,    DisconnectSR.RequestedDiscoDate,    DisconnectSR.RequestedCancelDate,    DisconnectSR.DateSubmittedToVendor,    DisconnectSR.ReturnTicketNumber,    DisconnectSR.VendorDisconnectNumber,    ServiceRequest.IRGDescription,    ServiceRequest.SOWEnablerName   ,DisconnectSR.DisconnectReasonName DiscoReasonName   ,DisconnectSR.CancellationReasonName CancelReasonName   ,RequestedByPerson.PersonEmail1 SubmittedBy   ,DisconnectSR.NotesFromCustomer DiscoNotes  From SimplifiedSR ServiceRequest     Inner Join Account On Account.AccountID = ServiceRequest.AccountIDF And ServiceRequest.CurrentWorkcenterIDF = 12    Inner Join Company On Company.CompanyID = Account.CustomerCompanyIDF    Inner Join Part On ServiceRequest.PartIDF = Part.PartID And Part.ProductClassIDF = 5 And Part.SubClassIDF In (168, 162)    Inner Join Company Vendor  On Part.VendorCompanyIDF = Vendor.CompanyID    Inner Join Site On Site.SiteID = ServiceRequest.SiteIDF And Site.AccountIDF = ServiceRequest.AccountIDF    Left Join [Order] On [Order].OrderID = ServiceRequest.OrderIDF    Left Join DisconnectSR On DisconnectSR.DisconnectID = ServiceRequest.ServiceRequestID    Left Join SimplifiedSR OriginatingSR  On ServiceRequest.OriginatingSR = OriginatingSR.ServiceRequestID    Left Join Part OriginatingSRPart  On OriginatingSR.PartIDF = OriginatingSRPart.PartID    Left Join Company OriginatingSRVendor  On OriginatingSRPart.VendorCompanyIDF = OriginatingSRVendor.CompanyID    Left Join (Select DISTINCT PersonID, PersonEmail1 FROM Person) RequestedByPerson On DisconnectSR.RequestedByPersonIDF = RequestedByPerson.PersonID         Where ServiceRequest.CurrentServiceRequestStatus Not In (''Disconnected'',    ''Changed - Disconnected'', ''Pending Cancellation'', ''Changed'',    ''Pending Change Order'', ''Changed - Disconnected'', ''CHG:Pending Change Reques'',    ''CHG:MNS Change Complete'')'
	where QueryID = 135
else
	begin 
		select 'Update Failed queryid = 135, Procurement - Disco and Cancel Orders'
		select QueryID, QueryName,  TSQLText from tblQuery where QueryID = 135
	end
if(select LastUpdated from tblQuery where queryid = 146) = '2021-06-09 22:58:00'
	update tblQuery
	set TSQLText = 'Select Distinct ServiceRequest.ServiceRequestID,    ServiceRequest.OrderIDF, OrdType.OrderTypeName OrderBillingType,    OrderSalesType.OrderSalesTypeName OrderSalesType,    ServiceRequest.SalesOrderIDF As [Sales Order],    Person.FullName As [Executed By],    SalesOrder.DateTimeExecuted,    Replace(Replace(Replace([Company (Client)].LegalName, Char(13) + Char(10),    '' ''), Char(10), '' ''), '','', '' '') As [Client Name],    Account.AccountID,    Replace(Replace(Replace(Account.AccountName, Char(13) + Char(10), '' ''),    Char(10), '' ''), '','', '' '') AccountName,    Replace(Replace(Replace(Site.CxSiteNumber, Char(13) + Char(10), '' ''),    Char(10), '' ''), '','', '' '') CxSiteNumber,    Replace(Replace(Replace(Site.SiteName, Char(13) + Char(10), '' ''), Char(10),    '' ''), '','', '' '') SiteName,    Replace(Replace(Replace(Site.SiteAddress1, Char(13) + Char(10), '' ''),    Char(10), '' ''), '','', '' '') SiteAddress1,    Site.SiteAddress2,    Replace(Replace(Replace(Site.SpaceNumber, Char(13) + Char(10), '' ''), Char(10),    '' ''), '','', '' '') SpaceNumber,    Site.SiteCity,    Site.SiteState,    Site.SiteZip,    Site.SiteID,    Replace(Replace(Replace(ServiceRequest.CxGLCode1, Char(13) + Char(10), '' ''),    Char(10), '' ''), '','', '' '') CxGLCode1,    Part.ProductClassName,    Part.SubClassName,    Part.IRGNumber As PartNumber,    Replace(Replace(Replace(Part.IRGDescription, Char(13) + Char(10), '' ''),    Char(10), '' ''), '','', '' '') IRGDescription,    ServiceRequest.IsSRLOA As [LOA Switch?],    ServiceRequest.EnablerRoleName As [Enabler Role],    ServiceRequest.CurrentServiceRequestStatus,    ServiceRequest.MainServiceRequestStatusName,    Workcenter.WorkcenterName,    ServiceRequest.ServiceStartDate,    ServiceRequest.ServiceEndDate,    ServiceRequest.BillingStartDate,    ServiceRequest.BillingEndDate,    ServiceRequest.CompletedDateTime,    ServiceRequest.RenewalDate,    tblTerm.StartDate As LastRenewalDate,    DateAdd(month, usysTermLength.LengthInMonths, tblTerm.StartDate) -    1 As [Term End Date],    ServiceRequest.TermDaysRemaining,    Account.TermLengthName,    Replace(Replace(Replace([Company (Vendor)].LegalName, Char(13) + Char(10),    '' ''), Char(10), '' ''), '','', '' '') [Vendor Name],    Part.BaseCost As [Base Cost],    Procurement1.UnitCost As [Actual Cost],    Procurement1.AnticipatedCost As [Anticipated Cost],    A.ExtPrice As [Client Price],    Replace(Replace(Replace(ServiceRequest.BundleName, Char(13) + Char(10), '' ''),    Char(10), '' ''), '','', '' '') BundleName,    Replace(Replace(Replace(ServiceRequest.VendorOrderNumber, Char(13) + Char(10),    '' ''), Char(10), '' ''), '','', '' '') VendorOrderNumber,    Replace(Replace(Replace(ServiceRequest.VendorCircuitID, Char(13) + Char(10),    '' ''), Char(10), '' ''), '','', '' '') VendorCircuitID,    Replace(Replace(Replace(Finance.VendorBTN, Char(13) + Char(10), '' ''),    Char(10), '' ''), '','', '' '') VendorBTN,    Replace(Replace(Replace(Finance.VendorBillingAccountNumber, Char(13) +    Char(10), '' ''), Char(10), '' ''), '','', '' '') VendorBillingAccountNumber,    Replace(Replace(Replace(Finance.VendorRegionalBillingNumber, Char(13) +    Char(10), '' ''), Char(10), '' ''), '','', '' '') VendorRegionalBillingNumber,    Procurement1.ActivationDate,    Procurement1.DueDate,    Procurement1.RequestedDueDate,    ServiceRequest.VendorActivationDate,    ServiceRequest.VendorDeactivationDate,    ServiceRequest.FOC,    ServiceRequest.FOCMet,    DisconnectSR.CancelledServiceRequestIDF,    Replace(Replace(Replace(DisconnectSR.VendorDisconnectNumber, Char(13) +    Char(10), '' ''), Char(10), '' ''), '','', '' '') VendorDisconnectNumber,    DisconnectSR.VendorBillingEndDate From Part    Inner Join SimplifiedSR ServiceRequest On ServiceRequest.PartIDF = Part.PartID      And Part.SubClassName Not In (''DSC'', ''CNCL'', ''ETF'') Inner Join tblManagedSR On ServiceRequest.ServiceRequestID =      tblManagedSR.ManagedSRID    Inner Join Site On ServiceRequest.SiteIDF = Site.SiteID Inner Join tblOrder Ord On OrderIDF = Ord.OrderID Inner Join usysOrderType OrdType On Ord.OrderTypeIDF = OrdType.OrderTypeID Inner Join Company [Company (Vendor)] On Part.VendorCompanyIDF =      [Company (Vendor)].CompanyID Inner Join Account On Account.AccountID = ServiceRequest.AccountIDF Left Outer Join tblSalesOrder SalesOrder On SalesOrder.SalesOrderID =      ServiceRequest.SalesOrderIDF    Left Outer Join Person On SalesOrder.ExecutedByPersonIDF = Person.PersonID    Left Outer Join usysOrderSalesType OrderSalesType On Ord.OrderSalesTypeIDF =      OrderSalesType.OrderSalesTypeID    Left Outer Join Workcenter On Workcenter.WorkcenterID =      ServiceRequest.CurrentWorkcenterIDF    Left Outer Join DisconnectSR On ServiceRequest.ServiceRequestID =      DisconnectSR.CancelledServiceRequestIDF    Left Outer Join tblTerm On tblManagedSR.TermIDF = tblTerm.TermID    Left Outer Join usysTermLength On tblTerm.TermLengthIDF =      usysTermLength.TermLengthID    Left Outer Join Finance On ServiceRequest.ServiceRequestID =      Finance.ServiceRequestID    Left Outer Join (Select InvoiceLineItem.ServiceRequestIDF,      Min(InvoiceLineItem.ExtPrice) As ExtPrice,      Min(InvoiceLineItem.InvoiceDate) As InvoiceDate    From InvoiceLineItem    Group By InvoiceLineItem.ServiceRequestIDF) As A      On ServiceRequest.ServiceRequestID = A.ServiceRequestIDF    Left Outer Join Company [Company (Client)] On [Company (Client)].CompanyID =      Account.CustomerCompanyIDF    Left Outer Join Procurement Procurement1 On Procurement1.ServiceRequestID =      ServiceRequest.ServiceRequestID  Where Part.SubClassName Not In (''DSC'', ''CNCL'', ''ETF'')'
	where QueryID = 146
else
	begin 
		select 'Update Failed queryid = 146, Billing - Complete Finance Query'
		select QueryID, QueryName,  TSQLText from tblQuery where QueryID = 146
	end
if(select LastUpdated from tblQuery where queryid = 147) = '2014-05-06 08:55:00'
	update tblQuery
	set TSQLText = 'Select Distinct Company.LegalName As Company,    Account.AccountName,    ServiceRequest.AccountIDF,    ServiceRequest.SalesOrderIDF,    SalesOrder.SalesOrderStatusName,    SalesOrder.DateTimeExecuted,    SalesOrder.LastName,    Site.SiteName,    Site.CxSiteNumber,    Site.SiteAddress1,    Site.SpaceNumber,    Site.SiteAddress2,    Site.SiteCity,    Site.SiteState,    Site.SiteZip,    Site.LocalTN,    Site.DSLTN,    [Order].OrderID, [Order].OrderSalesType,[Order].BillingType,   [Order].SiteTypeName,    [Order].PriorityName,    [Order].CurrentOrderStatus,    Workcenter.WorkcenterName,    ServiceRequest.ServiceRequestID,    ServiceRequest.CurrentServiceRequestStatus,    TaskException.ExceptionScheduleDate,    TaskException.ExceptionNotes,    TaskException.ExceptionDateCreated,    TaskException.ExceptionLastUpdated,    ServiceRequest.VendorOrderNumber,    ServiceRequest.VendorCircuitID,    Part.ProductClassName,    Part.IRGNumber,    Part.IRGDescription,    Vendor.LegalName As Vendor,    DateDiff(d, ServiceRequest.LastUpdatedDatetime, GetDate()) As    NumberOfDaysInCurrentStatus  From Company    Inner Join Account On Company.CompanyID = Account.CustomerCompanyIDF    Right Join ServiceRequest On Account.AccountID = ServiceRequest.AccountIDF    Left Join [Order] On [Order].OrderID = ServiceRequest.OrderIDF    Inner Join Part On ServiceRequest.PartIDF = Part.PartID    Inner Join Company Vendor On Part.VendorCompanyIDF = Vendor.CompanyID    Inner Join Workcenter On ServiceRequest.CurrentWorkcenterIDF =      Workcenter.WorkcenterID    Left Join Site On Site.SiteID = ServiceRequest.SiteIDF    Left Join (Select SalesOrder.SalesOrderID,      SalesOrder.DateTimeExecuted,      SalesOrder.SalesOrderStatusName,      Person.LastName    From SalesOrder      Inner Join Person On SalesOrder.ExecutedByPersonIDF = Person.PersonID    Where Not SalesOrder.SalesOrderTypeName Like ''%Change%'') SalesOrder      On ServiceRequest.SalesOrderIDF = SalesOrder.SalesOrderID    Left Join TaskException On ServiceRequest.ServiceRequestID =      TaskException.ServiceRequestIDF And      ServiceRequest.CurrentServiceRequestStatusIDF =      TaskException.ServiceRequestStatusIDF  Where Workcenter.WorkcenterName Like ''procure%'' And    ServiceRequest.CurrentServiceRequestStatus Not Like ''%Disconnect%'' And    ServiceRequest.CurrentServiceRequestStatus Not Like ''%Cancellation%''    And ServiceRequest.CurrentServiceRequestStatus Not Like ''%Change%''  Order By Account.AccountName,    [Order].OrderID,    Part.ProductClassName'
	where QueryID = 147
else
	begin 
		select 'Update Failed queryid = 147, Procurement - New Orders ALL'
		select QueryID, QueryName,  TSQLText from tblQuery where QueryID = 147
	end
if(select LastUpdated from tblQuery where queryid = 625) = '2021-06-09 23:01:00'
	update tblQuery
	set TSQLText = 'Select Distinct ServiceRequest.ServiceRequestID,    ServiceRequest.OrderIDF,    OrderSalesType, BillingType,   ServiceRequest.SalesOrderIDF As [Sales Order]  ,    Person.FullName As [Executed By],    SalesOrder.DateTimeExecuted,    [Company (Client)].LegalName As [Client Name],    Account.AccountID  ,    Account.AccountName,    Site.BillingSiteID,    Site.CxSiteNumber,    Replace(Replace(Replace(Site.SiteName, Char(13) + Char(10), '' ''), Char(10),    '' ''), '','', '' '') SiteName  ,    Site.SiteAddress1,    Site.SpaceNumber,    Site.SiteCity,    Site.SiteState,    Site.SiteZip,    ServiceRequest.CxGLCode1,    Part.ProductClassName,    Part.SubClassName  ,    Part.IRGNumber As PartNumber,    Replace(Replace(Replace(Part.IRGDescription, Char(13) + Char(10), '' ''),    Char(10), '' ''), '','', '' '') IRGDescription  ,    ServiceRequest.IsSRLOA As [LOA Switch?],    ServiceRequest.EnablerRoleName As [Enabler Role],    ServiceRequest.CurrentServiceRequestStatus  ,    ServiceRequest.MainServiceRequestStatusName,    Workcenter.WorkcenterName,    ServiceRequest.ServiceStartDate,    ServiceRequest.ServiceEndDate  ,    ServiceRequest.BillingStartDate,    ServiceRequest.BillingEndDate,    ServiceRequest.CompletedDateTime,    ServiceRequest.RenewalDate  ,    tblTerm.StartDate As LastRenewalDate,    DateAdd(month, usysTermLength.LengthInMonths, tblTerm.StartDate) -    1 As [Term End Date]  ,    ServiceRequest.TermDaysRemaining, usysTermLength.TermLengthName SRTermLength,    [Company (Vendor)].LegalName As [Vendor Name],    Part.BaseCost As [Base Cost]  ,    Procurement.UnitCost As [Actual Cost],    Procurement.AnticipatedCost As [Anticipated Cost],    SRStatistics.SRRev As [Client Price]  ,    ServiceRequest.BundleName,    Procurement.ActivationDate,    Procurement.DueDate,    Procurement.RequestedDueDate,    ServiceRequest.VendorActivationDate  ,    ServiceRequest.VendorDeactivationDate,    ServiceRequest.FOC,    ServiceRequest.FOCMet,    Broadband.MTN,    CPESR.SerialNumber,    ServiceRequest.VendorCircuitID,    ServiceRequest.VendorOrderNumber As VendorOrder#,    Finance.VendorBTN,    Finance.VendorBillingAccountNumber As [BillingAcc.#]  ,    Finance.VendorRegionalBillingNumber As RegionalBilling#  ,    Broadband.Demarc,    Broadband.ExtendedDemarc As [Ex.Dmarc],    Broadband.HandOffMethodName,    Broadband.IPAdress  ,    Broadband.SubnetMask,    Broadband.Gateway,    Broadband.IPUsableRangeStart,    Broadband.IPUsableRangeEnd,    Broadband.DNS1,    Broadband.DNS2,    Broadband.PPPUserName  ,    Broadband.PPPPassword,    Broadband.InstalledSignalStrength As [Installed Signal]  ,    CircuitTest.SPT_Downspeed As [SPT Downspeed],    CircuitTest.SPT_Upspeed As [SPT Upspeed]  ,    Part.CxGBDataAllowance,    ServiceRequest.SOWEnablerName  From Site Inner Join SimplifiedSR ServiceRequest On ServiceRequest.SiteIDF = Site.SiteID Inner Join Account On Account.AccountID = ServiceRequest.AccountIDF Inner Join Part On ServiceRequest.PartIDF = Part.PartID And Part.ProductClassIDF =    7 Inner Join tblManagedSR On ServiceRequest.ServiceRequestID =      tblManagedSR.ManagedSRID Inner Join [Order] On OrderIDF = [Order].OrderID Left Join Broadband On Broadband.ServiceRequestID =      ServiceRequest.ServiceRequestID Left Join tblTerm On tblManagedSR.TermIDF = tblTerm.TermID Left Join usysTermLength On tblTerm.TermLengthIDF =      usysTermLength.TermLengthID Inner Join Company [Company (Vendor)] On Part.VendorCompanyIDF =      [Company (Vendor)].CompanyID Left Join Finance On ServiceRequest.ServiceRequestID =      Finance.ServiceRequestID Left Join Procurement On Procurement.ServiceRequestID =      ServiceRequest.ServiceRequestID Left Join SRStatistics On ServiceRequest.ServiceRequestID =      SRStatistics.ServiceRequestID Left Join Company [Company (Client)] On [Company (Client)].CompanyID =      Account.CustomerCompanyIDF Left Join SalesOrder On SalesOrder.SalesOrderID = ServiceRequest.SalesOrderIDF Left Join Workcenter On Workcenter.WorkcenterID =      ServiceRequest.CurrentWorkcenterIDF Left Join Person On SalesOrder.ExecutedByPersonIDF = Person.PersonID Left Join CPESR On CPESR.CPESRID = ServiceRequest.ServiceRequestID Left Join (Select LastTest.*    From (Select CircuitTest.ServiceRequestID,        CircuitTest.SPT_Downspeed,        CircuitTest.SPT_Upspeed,        Rank() Over (Partition By CircuitTest.ServiceRequestID Order By        CircuitTest.CircuitTestID Desc) Rnk      From CircuitTest) LastTest    Where LastTest.Rnk = 1) CircuitTest On CircuitTest.ServiceRequestID =      ServiceRequest.ServiceRequestID   Where Part.SubClassName Not In (''DSC'', ''CNCL'', ''ETF'')'
	where QueryID = 625
else
	begin 
		select 'Update Failed queryid = 625, Billing - Complete Finance Query - TMG'
		select QueryID, QueryName,  TSQLText from tblQuery where QueryID = 625
	end
if(select LastUpdated from tblQuery where queryid = 628) = '2021-06-09 23:00:00'
	update tblQuery
	set TSQLText = 'Select Distinct ServiceRequest.ServiceRequestID,    ServiceRequest.OrderIDF,    [Order].OrderSalesType, [Order].BillingType,    ServiceRequest.SalesOrderIDF As [Sales Order],    Person.FullName As [Executed By],    SalesOrder.DateTimeExecuted,    [Company (Client)].LegalName As [Client Name],    Account.AccountID,    Account.AccountName,    Site.CxSiteNumber,    Replace(Replace(Replace(Site.SiteName, Char(13) + Char(10), '' ''), Char(10),    '' ''), '','', '' '') SiteName,    Site.SiteCity,    Site.SiteState,    Site.SiteZip,    ServiceRequest.CxGLCode1,    Part.ProductClassName,    Part.SubClassName,    Part.IRGNumber As PartNumber,    Replace(Replace(Replace(Part.IRGDescription, Char(13) + Char(10), '' ''),    Char(10), '' ''), '','', '' '') IRGDescription,    ServiceRequest.IsSRLOA As [LOA Switch?],    ServiceRequest.EnablerRoleName As [Enabler Role],    ServiceRequest.CurrentServiceRequestStatus,    ServiceRequest.MainServiceRequestStatusName,    Workcenter.WorkcenterName,    ServiceRequest.ServiceStartDate,    ServiceRequest.ServiceEndDate,    ServiceRequest.BillingStartDate,    ServiceRequest.BillingEndDate,    ServiceRequest.CompletedDateTime,    ServiceRequest.RenewalDate,    ServiceRequest.TermDaysRemaining,    Account.TermLengthName,    [Company (Vendor)].LegalName As [Vendor Name],    Part.BaseCost As [Base Cost],    Procurement.UnitCost As [Actual Cost],    Procurement.AnticipatedCost As [Anticipated Cost],    SRStatistics.SRRev As [Client Price],    ServiceRequest.BundleName,    Procurement1.ActivationDate,    Procurement1.DueDate,    Procurement1.RequestedDueDate,    ServiceRequest.VendorActivationDate,    ServiceRequest.VendorDeactivationDate,    ServiceRequest.FOC,    ServiceRequest.FOCMet,    Broadband.MTN,    CPESR.SerialNumber,    CPESR.MACAddress,    CPESR.IMEINumber,    Part.CPEMakeName,    Part.CPEModelName From Site    Inner Join ServiceRequest On ServiceRequest.SiteIDF = Site.SiteID    Inner Join Account On Account.AccountID = ServiceRequest.AccountIDF    Inner Join Part On ServiceRequest.PartIDF = Part.PartID    Inner Join Company [Company (Vendor)] On Part.VendorCompanyIDF =      [Company (Vendor)].CompanyID    Inner Join [Order] On ServiceRequest.OrderIDF = [Order].OrderID    Left Join Finance On ServiceRequest.ServiceRequestID =      Finance.ServiceRequestID    Left Join SRAuditHistory On Finance.ServiceRequestID =      SRAuditHistory.ServiceRequestIDF    Left Join Procurement On Procurement.ServiceRequestID =      ServiceRequest.ServiceRequestID    Left Join SRStatistics On ServiceRequest.ServiceRequestID =      SRStatistics.ServiceRequestID    Left Join Company [Company (Client)] On [Company (Client)].CompanyID =      Account.CustomerCompanyIDF    Left Join SalesOrder On SalesOrder.SalesOrderID = ServiceRequest.SalesOrderIDF    Inner Join Workcenter On Workcenter.WorkcenterID =      ServiceRequest.CurrentWorkcenterIDF    Left Join Person On SalesOrder.ExecutedByPersonIDF = Person.PersonID    Left Join Procurement Procurement1 On Procurement1.ServiceRequestID =      ServiceRequest.ServiceRequestID    Left Join Broadband On Broadband.ServiceRequestID =      ServiceRequest.ServiceRequestID    Left Join CPESR On CPESR.CPESRID = ServiceRequest.ServiceRequestID  Where Not Part.SubClassName Like ''DSC'' And Not Part.SubClassName Like ''CNCL'' And    Not Part.SubClassName Like ''ETF'' And Part.ProductClassIDF = 1'
	where QueryID = 628
else
	begin 
		select 'Update Failed queryid = 628, Billing - Complete Finance Query - CPE'
		select QueryID, QueryName,  TSQLText from tblQuery where QueryID = 628
	end
if(select LastUpdated from tblQuery where queryid = 630) = '2021-06-09 23:00:00'
	update tblQuery
	set TSQLText = 'Select Distinct ServiceRequest.ServiceRequestID,    ServiceRequest.OrderIDF,    [Order].OrderSalesType,    [Order].BillingType,    ServiceRequest.SalesOrderIDF As [Sales Order],    Person.FullName As [Executed By],    SalesOrder.DateTimeExecuted,    [Company (Client)].LegalName As [Client Name],    Account.AccountID,    Account.AccountName,    Site.BillingSiteID,    Site.CxSiteNumber,    Replace(Replace(Replace(Site.SiteName, Char(13) + Char(10), '' ''), Char(10),    '' ''), '','', '' '') SiteName,    Site.SiteCity,    Site.SiteState,    Site.SiteZip,    ServiceRequest.CxGLCode1,    Part.ProductClassName,    Part.SubClassName,    Part.IRGNumber As PartNumber,    Replace(Replace(Replace(Part.IRGDescription, Char(13) + Char(10), '' ''),    Char(10), '' ''), '','', '' '') IRGDescription,    ServiceRequest.IsSRLOA As [LOA Switch?],    ServiceRequest.EnablerRoleName As [Enabler Role],    ServiceRequest.CurrentServiceRequestStatus,    ServiceRequest.MainServiceRequestStatusName,    Workcenter.WorkcenterName,    ServiceRequest.ServiceStartDate,    ServiceRequest.ServiceEndDate,    ServiceRequest.BillingStartDate,    ServiceRequest.BillingEndDate,    ServiceRequest.CompletedDateTime,    ServiceRequest.RenewalDate,    ServiceRequest.TermDaysRemaining,    Account.TermLengthName,    [Company (Vendor)].LegalName As [Vendor Name],    Part.BaseCost As [Base Cost],    Procurement.UnitCost As [Actual Cost],    Procurement.AnticipatedCost As [Anticipated Cost],    SRStatistics.SRRev As [Client Price],    ServiceRequest.BundleName,    Procurement1.ActivationDate,    Procurement1.DueDate,    Procurement1.RequestedDueDate,    ServiceRequest.VendorActivationDate,    ServiceRequest.VendorDeactivationDate,    ServiceRequest.FOC,    ServiceRequest.FOCMet,    Broadband.MTN,    CPESR.SerialNumber,    ProServiceSR.JobNumber From Site    Inner Join ServiceRequest On ServiceRequest.SiteIDF = Site.SiteID    Inner Join Account On Account.AccountID = ServiceRequest.AccountIDF    Inner Join Part On ServiceRequest.PartIDF = Part.PartID    Inner Join Company [Company (Vendor)] On Part.VendorCompanyIDF =      [Company (Vendor)].CompanyID    Inner Join [Order] On ServiceRequest.OrderIDF = [Order].OrderID    Left Join Finance On ServiceRequest.ServiceRequestID =      Finance.ServiceRequestID    Left Join SRAuditHistory On Finance.ServiceRequestID =      SRAuditHistory.ServiceRequestIDF    Left Join Procurement On Procurement.ServiceRequestID =      ServiceRequest.ServiceRequestID    Left Join SRStatistics On ServiceRequest.ServiceRequestID =      SRStatistics.ServiceRequestID    Left Join Company [Company (Client)] On [Company (Client)].CompanyID =      Account.CustomerCompanyIDF    Left Join SalesOrder On SalesOrder.SalesOrderID = ServiceRequest.SalesOrderIDF    Inner Join Workcenter On Workcenter.WorkcenterID =      ServiceRequest.CurrentWorkcenterIDF    Left Join Person On SalesOrder.ExecutedByPersonIDF = Person.PersonID    Left Join Procurement Procurement1 On Procurement1.ServiceRequestID =      ServiceRequest.ServiceRequestID    Left Join Broadband On Broadband.ServiceRequestID =      ServiceRequest.ServiceRequestID    Left Join CPESR On CPESR.CPESRID = ServiceRequest.ServiceRequestID    Left Join ProServiceSR On ServiceRequest.ServiceRequestID =      ProServiceSR.ProServiceSRID  Where Not Part.SubClassName Like ''DSC'' And Not Part.SubClassName Like ''CNCL'' And    Not Part.SubClassName Like ''ETF'' And Part.ProductClassIDF = 5'
	where QueryID = 630
else
	begin 
		select 'Update Failed queryid = 630, Billing - Complete Finance Query - RLAN'
		select QueryID, QueryName,  TSQLText from tblQuery where QueryID = 630
	end
if(select LastUpdated from tblQuery where queryid = 3072) = '2021-06-09 23:04:00'
	update tblQuery
	set TSQLText = 'Select Distinct Site.CxSiteNumber ,    Site.SiteName ,    CktSR.AccountIDF ,    [Order].SiteTypeName ,    [Order].OrderID ,    [Order].OrderSalesType,    [Order].BillingType,    CktSR.ServiceRequestID ,    CktSR.CurrentServiceRequestStatus ,    CktSR.EnablerRoleName ,    CktPart.IRGNumber ,    CktPart.ShortDescription ,    Broadband.FOC ,    Broadband.FOCMet ,    [Install SR].ScheduledDateTime As [CI Scheduled] ,    [Install SR].CompletedDateTime As [CI Complete] ,    Broadband.VendorCircuitID ,    Broadband.Demarc ,    Broadband.HandOffMethodName ,    Broadband.IPAdress ,    Broadband.SubnetMask ,    Broadband.Gateway ,    Broadband.IPUsableRangeStart ,    Broadband.IPUsableRangeEnd ,    Broadband.DNS1 ,    Broadband.DNS2 ,    Broadband.PPPUserName ,    Broadband.PPPPassword ,    [CPE SR].CPEMakeName ,    [CPE SR].CPEModelName ,    [CPE SR].SerialNumber ,    [DBU SR].Username As DBU_Username ,    [DBU SR].Password As DBU_Password ,    [DBU SR].DialOut1 As DBU_Dialout1 ,    [DBU SR].DialOut2 As DBU_Dialout2 ,    SRLastJournal.LastJournal ,    SRLastJournal.LastUpdated As [Last Journal Date] ,    CktSR.BillingEndDate ,    CktSR.SalesOrderIDF ,    Company.LegalName As Carrier   FROM Site     INNER Join SimplifiedSR  CktSR On CktSR.SiteIDF = Site.SiteID     Left Join SRLastJournal SRLastJournal    On CktSR.ServiceRequestID = SRLastJournal.ServiceRequestID    AND SRLastJournal.AuthorizedToIDF = 2 INNER Join Account On CktSR.AccountIDF = Account.AccountID     INNER Join Part CktPart On CktSR.PartIDF = CktPart.PartID     Left Join Broadband On CktSR.ServiceRequestID = Broadband.ServiceRequestID     INNER Join [Order] On [Order].OrderID = CktSR.OrderIDF     Left Join (Select Site.CxSiteNumber ,      ServiceRequest.OrderIDF ,      ServiceRequest.ServiceRequestID ,      ServiceRequest.ScheduledDateTime ,      ServiceRequest.CompletedDateTime ,      ServiceRequest.VendorCompanyIDF FROM SimplifiedSR ServiceRequest  INNER Join Site On ServiceRequest.SiteIDF = Site.SiteID  Where ServiceRequest.VendorCompanyIDF <> 304 And      ServiceRequest.VendorCompanyIDF <> 361 And ServiceRequest.VendorCompanyIDF      <> 4692 And ServiceRequest.VendorCompanyIDF <> 4693 And      (ServiceRequest.SubClassIDF = 39 Or ServiceRequest.SubClassIDF =        40) AND ServiceRequest.AccountIDF In (1000001045, 1000001026, 1000001001, 1000000996,    1000000988, 1000000993, 1000000903, 1000001052, 1000001092, 1000001102)  ) [Install SR] On CktSR.OrderIDF = [Install SR].OrderIDF And      CktSR.VendorCompanyIDF = [Install SR].VendorCompanyIDF     Left Join (Select Site.CxSiteNumber ,      ServiceRequest.OrderIDF ,      ServiceRequest.ServiceRequestID ,      Part.CPEMakeName ,      Part.CPEModelName ,      CPESR.SerialNumber ,      ServiceRequest.VendorCompanyIDF     FROM SimplifiedSR ServiceRequest       INNER Join Site On ServiceRequest.SiteIDF = Site.SiteID       Left Join CPESR On ServiceRequest.ServiceRequestID = CPESR.CPESRID       INNER Join Part On ServiceRequest.PartIDF = Part.PartID Where ServiceRequest.SubClassIDF = 165 AND ServiceRequest.AccountIDF In (1000001045, 1000001026, 1000001001, 1000000996,    1000000988, 1000000993, 1000000903, 1000001052, 1000001092, 1000001102)   ) [CPE SR] On CktSR.OrderIDF =      [CPE SR].OrderIDF And CktSR.VendorCompanyIDF = [CPE SR].VendorCompanyIDF     Left Join (Select Site.CxSiteNumber ,      ServiceRequest.OrderIDF ,      ServiceRequest.ServiceRequestID ,      DBUSR.Username ,      DBUSR.Password ,      DBUSR.DialOut1 ,      DBUSR.DialOut2 ,      ServiceRequest.EnablerRoleName     FROM SimplifiedSR ServiceRequest       INNER Join Site On ServiceRequest.SiteIDF = Site.SiteID       INNER Join DBUSR On ServiceRequest.ServiceRequestID =        DBUSR.ServiceRequestID ) [DBU SR] On Site.CxSiteNumber =      [DBU SR].CxSiteNumber And CktSR.EnablerRoleName = [DBU SR].EnablerRoleName     INNER Join Company On CktSR.VendorCompanyIDF = Company.CompanyID Where CktSR.AccountIDF In (1000001045, 1000001026, 1000001001, 1000000996,    1000000988, 1000000993, 1000000903, 1000001052, 1000001092, 1000001102)  And CktSR.CurrentServiceRequestStatus Not Like ''%changed%''  And    CktSR.CurrentServiceRequestStatus Not Like ''%disc%''  And    CktSR.CurrentServiceRequestStatus Not Like ''%canc%''  And    CktPart.IsCircuitPart = 1  Order By Site.CxSiteNumber ,    CktSR.EnablerRoleName'
	where QueryID = 3072
else
	begin 
		select 'Update Failed queryid = 3072, Billing - Complete Finance Query w. Audit History'
		select QueryID, QueryName,  TSQLText from tblQuery where QueryID = 3072
	end

